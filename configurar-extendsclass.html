<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Configurar ExtendsClass</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; max-width: 600px; }
        .step { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; width: 300px; }
        button { padding: 8px 16px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; background: #007bff; color: white; }
        .btn-success { background: #28a745; }
        .btn-warning { background: #ffc107; color: #212529; }
    </style>
</head>
<body>
    <h1>üîß Configurar ExtendsClass para tu Agenda</h1>

    <div class="step">
        <h3>Paso 1: Obtener API Key</h3>
        <p>1. Ve a <a href="https://extendsclass.com/json-storage.html" target="_blank">ExtendsClass JSON Storage</a></p>
        <p>2. Haz clic en "Sign up" o "Sign in"</p>
        <p>3. Una vez logueado, ve a tu perfil (icono de usuario)</p>
        <p>4. Copia tu "API Key"</p>
    </div>

    <div class="step">
        <h3>Paso 2: Probar API Key</h3>
        <label>Pega tu API Key aqu√≠:</label><br>
        <input type="text" id="apiKey" placeholder="Tu API Key de ExtendsClass">
        <br>
        <button onclick="probarAPIKey()">Probar Conexi√≥n</button>
        <div id="resultado"></div>
    </div>

    <div class="step">
        <h3>Paso 3: Configurar en tu Agenda</h3>
        <p>Una vez que la prueba sea exitosa:</p>
        <ol>
            <li>Abre tu agenda principal (src/index.html)</li>
            <li>Haz clic en ‚öôÔ∏è (Configuraci√≥n)</li>
            <li>Ve a la pesta√±a "ExtendsClass"</li>
            <li>Pega tu API Key</li>
            <li>Haz clic en "Guardar" y luego "Probar"</li>
        </ol>
        <button class="btn-success" onclick="abrirAgenda()">Abrir Agenda Principal</button>
    </div>

    <script>
        async function probarAPIKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const resultado = document.getElementById('resultado');
            
            if (!apiKey) {
                resultado.innerHTML = '<div class="error">Por favor ingresa tu API Key</div>';
                return;
            }

            resultado.innerHTML = '<div class="info">üîÑ Probando conexi√≥n...</div>';

            try {
                const testData = { test: true, timestamp: Date.now() };
                
                const response = await fetch('https://json.extendsclass.com/bin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Api-key': apiKey
                    },
                    body: JSON.stringify(testData)
                });

                if (response.ok) {
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        const result = await response.json();
                        
                        // Guardar API Key para usar en la agenda
                        localStorage.setItem('extendsclass-api-key', apiKey);
                        
                        resultado.innerHTML = `
                            <div class="success">
                                ‚úÖ <strong>¬°Conexi√≥n exitosa!</strong><br>
                                Bin de prueba creado: ${result.id}<br>
                                Tu API Key ha sido guardada localmente.<br>
                                <button class="btn-success" onclick="abrirAgenda()">Abrir Agenda</button>
                            </div>
                        `;
                        
                        // Limpiar bin de prueba
                        try {
                            await fetch(`https://json.extendsclass.com/bin/${result.id}`, {
                                method: 'DELETE'
                            });
                        } catch (e) {}
                        
                    } else {
                        resultado.innerHTML = '<div class="error">‚ùå Respuesta no v√°lida del servidor</div>';
                    }
                } else if (response.status === 401) {
                    resultado.innerHTML = '<div class="error">‚ùå API Key inv√°lido. Verifica que sea correcto.</div>';
                } else {
                    resultado.innerHTML = `<div class="error">‚ùå Error ${response.status}. Intenta de nuevo.</div>`;
                }

            } catch (error) {
                resultado.innerHTML = `<div class="error">‚ùå Error de conexi√≥n: ${error.message}</div>`;
            }
        }

        function abrirAgenda() {
            window.open('src/index.html', '_blank');
        }

        // Cargar API Key guardada si existe
        window.onload = function() {
            const savedApiKey = localStorage.getItem('extendsclass-api-key');
            if (savedApiKey) {
                document.getElementById('apiKey').value = savedApiKey;
                document.getElementById('resultado').innerHTML = '<div class="info">üí° API Key cargada desde configuraci√≥n anterior</div>';
            }
        };
    </script>
</body>
</html>